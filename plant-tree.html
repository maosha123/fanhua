<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¼€å§‹ç§æ ‘ - å‡¡åŒ–èŒ¶æ ‘</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        // é…ç½®Tailwindè‡ªå®šä¹‰é¢œè‰²
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        darkGreen: '#2E7D32',
                        lightGreen: '#C8E6C9',
                        mediumGreen: '#66BB6A',
                        teaBrown: '#8D6E63',
                    },
                    fontFamily: {
                        sans: ['PingFang SC', 'Helvetica Neue', 'Arial', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .card-shadow {
                box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            }
            .progress-bar {
                transition: width 0.5s ease-in-out;
            }
            .btn-press {
                transform: scale(0.95);
                transition: transform 0.1s ease;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans">
    <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
    <header class="bg-darkGreen text-white py-4 px-4 shadow-md">
        <div class="container mx-auto flex justify-between items-center">
            <button id="backBtn" class="text-white">
                <i class="fa fa-arrow-left text-xl"></i>
            </button>
            <div class="text-center">
                <h1 class="text-[clamp(1.5rem,5vw,2rem)] font-bold text-shadow">å¼€å§‹ç§æ ‘</h1>
            </div>
            <div class="w-10"></div> <!-- å ä½å…ƒç´ ï¼Œä¿æŒæ ‡é¢˜å±…ä¸­ -->
        </div>
    </header>

    <!-- ä¸»ä½“å†…å®¹åŒº -->
    <main class="container mx-auto px-4 py-8">
        <div class="bg-white rounded-xl p-6 card-shadow">
            <div class="text-center mb-8">
                <div id="treeStage" class="text-8xl mb-4">ğŸŒ±</div>
                <p id="treeStatus" class="text-gray-700 text-xl">å¹¼è‹—é˜¶æ®µ</p>
                <div class="mt-4 mb-2">
                    <p class="text-gray-700 text-sm mb-1" id="stageProgressText">æˆé•¿è¿›åº¦: 0/3æ¬¡æ–½è‚¥</p>
                    <div class="w-full bg-gray-200 rounded-full h-3">
                        <div id="stageProgressBar" class="progress-bar bg-mediumGreen h-full rounded-full" style="width: 0%"></div>
                    </div>
                </div>
            </div>
            
            <div class="mb-8">
                <p class="text-gray-700 mb-2 text-center">å½“å‰èƒ½é‡: <span id="fertilizerEnergy" class="font-bold text-darkGreen">65</span>/100</p>
                <div class="w-full bg-gray-200 rounded-full h-5 mb-2">
                    <div id="fertilizerProgress" class="progress-bar bg-darkGreen h-full rounded-full" style="width: 65%"></div>
                </div>
                <p class="text-sm text-gray-500 text-center">æ¯ç§¯ç´¯100èƒ½é‡å¯å…‘æ¢1æ¬¡æ–½è‚¥</p>
            </div>
            
            <button id="fertilizeBtn" class="w-full bg-mediumGreen hover:bg-darkGreen text-white font-bold py-4 px-4 rounded-lg transition duration-300 text-lg">
                <i class="fa fa-leaf mr-2"></i> æ–½è‚¥
            </button>
        </div>
    </main>

    <!-- åº•éƒ¨å¯¼èˆªæ  -->
    <footer class="fixed bottom-0 left-0 right-0 bg-white shadow-lg border-t border-gray-200">
        <div class="grid grid-cols-3 h-16">
            <a href="index.html" class="flex flex-col items-center justify-center text-darkGreen font-medium">
                <i class="fa fa-home text-xl mb-1"></i>
                <span>é¦–é¡µ</span>
            </a>
            <a href="ranking.html" class="flex flex-col items-center justify-center text-gray-500 font-medium">
                <i class="fa fa-trophy text-xl mb-1"></i>
                <span>æ’è¡Œæ¦œ</span>
            </a>
            <a href="profile.html" class="flex flex-col items-center justify-center text-gray-500 font-medium">
                <i class="fa fa-user text-xl mb-1"></i>
                <span>ä¸ªäººä¸­å¿ƒ</span>
            </a>
        </div>
    </footer>

    <script>
        // åˆå§‹åŒ–åº”ç”¨æ•°æ®
        function initAppData() {
            const today = new Date().toISOString().split('T')[0];
            const appData = localStorage.getItem('teaPlantAppData');
            
            if (!appData) {
                // é¦–æ¬¡ä½¿ç”¨ï¼Œåˆå§‹åŒ–æ•°æ®
                const initialData = {
                    energy: 65,
                    maxEnergy: 100,
                    totalEnergy: 120,
                    treeCount: 1, // æ–°ç”¨æˆ·åˆå§‹1æ ªèŒ¶è‹—
                    treeStage: 0, // 0: å¹¼è‹—, 1: æˆè‹—, 2: æˆç†Ÿ
                    stageProgress: 0, // å½“å‰é˜¶æ®µæ–½è‚¥è¿›åº¦
                    stageRequirements: [3, 5], // å„é˜¶æ®µæ‰€éœ€æ–½è‚¥æ¬¡æ•°
                    lastEnergyDate: null,
                    dailyEnergyEarned: 0,
                    userName: `èŒ¶å†œ${Math.floor(10000 + Math.random() * 90000)}`,
                    isNewUser: true // æ–°ç”¨æˆ·æ ‡è¯†
                };
                localStorage.setItem('teaPlantAppData', JSON.stringify(initialData));
                return initialData;
            } else {
                const data = JSON.parse(appData);
                // æ£€æŸ¥æ˜¯å¦æ˜¯æ–°çš„ä¸€å¤©ï¼Œé‡ç½®æ¯æ—¥èƒ½é‡è·å–
                if (data.lastEnergyDate !== today) {
                    data.dailyEnergyEarned = 0;
                    data.lastEnergyDate = today;
                    localStorage.setItem('teaPlantAppData', JSON.stringify(data));
                }
                return data;
            }
        }

        // è·å–åº”ç”¨æ•°æ®
        function getAppData() {
            const appData = localStorage.getItem('teaPlantAppData');
            if (!appData) return initAppData();
            
            // è§£æç°æœ‰æ•°æ®å¹¶æ·»åŠ æ–°å±æ€§é»˜è®¤å€¼
            const data = JSON.parse(appData);
            if (data.stageProgress === undefined) data.stageProgress = 0;
            if (data.stageRequirements === undefined) data.stageRequirements = [3, 5];
            if (data.isNewUser === undefined) data.isNewUser = false;
            
            return data;
        }

        // ä¿å­˜åº”ç”¨æ•°æ®
        function saveAppData(data) {
            localStorage.setItem('teaPlantAppData', JSON.stringify(data));
            console.log('åº”ç”¨æ•°æ®å·²ä¿å­˜');
        }

        // æ›´æ–°UIæ˜¾ç¤º
        function updateUI() {
            const data = getAppData();
            
            // æ›´æ–°èƒ½é‡æ˜¾ç¤º
            const energyPercent = Math.min(100, Math.round((data.energy / data.maxEnergy) * 100));
            document.getElementById('fertilizerEnergy').textContent = data.energy;
            document.getElementById('fertilizerProgress').style.width = `${energyPercent}%`;
            
            // æ›´æ–°èŒ¶æ ‘é˜¶æ®µæ˜¾ç¤º
            const treeStages = ['ğŸŒ±', 'ğŸŒ¿', 'ğŸµ'];
            const treeStatusTexts = ['å¹¼è‹—é˜¶æ®µ', 'æˆè‹—é˜¶æ®µ', 'æˆç†Ÿé˜¶æ®µ'];
            document.getElementById('treeStage').textContent = treeStages[data.treeStage];
            document.getElementById('treeStatus').textContent = treeStatusTexts[data.treeStage];
            
            // æ›´æ–°æˆé•¿è¿›åº¦æ˜¾ç¤º
            if (data.treeStage < 2) {
                const required = data.stageRequirements[data.treeStage];
                const progressPercent = Math.round((data.stageProgress / required) * 100);
                document.getElementById('stageProgressText').textContent = `æˆé•¿è¿›åº¦: ${data.stageProgress}/${required}æ¬¡æ–½è‚¥`;
                document.getElementById('stageProgressBar').style.width = `${progressPercent}%`;
            } else {
                // æˆç†Ÿé˜¶æ®µéšè—è¿›åº¦æ¡
                document.getElementById('stageProgressText').style.display = 'none';
                document.getElementById('stageProgressBar').style.display = 'none';
            }
        }

        // æ–½è‚¥åŠŸèƒ½
        function fertilizeTree() {
            const data = getAppData();
            
            if (data.energy >= data.maxEnergy) {
                // æ¶ˆè€—èƒ½é‡æ–½è‚¥
                data.energy -= data.maxEnergy;
                
                // èŒ¶æ ‘ç”Ÿé•¿é˜¶æ®µæå‡
                if (data.treeStage < 2) {
                    data.treeStage++;
                    console.log(`èŒ¶æ ‘å·²è¿›å…¥${data.treeStage === 1 ? 'æˆè‹—' : 'æˆç†Ÿ'}é˜¶æ®µ`);
                    
                    // å¦‚æœèŒ¶æ ‘æˆç†Ÿï¼Œæç¤ºå¯ä»¥å…‘æ¢ç¤¼å“
                    if (data.treeStage === 2) {
                        setTimeout(() => {
                            alert('æ­å–œï¼æ‚¨çš„èŒ¶æ ‘å·²æˆç†Ÿï¼Œå¯ä»¥å…‘æ¢å‡¡åŒ–æ‘èŒ¶å¶ç¤¼å“äº†ï¼');
                        }, 500);
                    }
                } else {
                    // æˆç†ŸèŒ¶æ ‘æ–½è‚¥ï¼Œå¢åŠ èŒ¶è‹—æ•°é‡
                    data.treeCount++;
                    console.log('è·å¾—æ–°èŒ¶è‹—ï¼å½“å‰æ‹¥æœ‰èŒ¶è‹—ï¼š' + data.treeCount + 'æ ª');
                    alert('æ­å–œï¼æ‚¨è·å¾—äº†ä¸€æ ªæ–°èŒ¶è‹—ï¼');
                }
                
                saveAppData(data);
                updateUI();
            } else {
                alert('èƒ½é‡ä¸è¶³ï¼Œæ— æ³•æ–½è‚¥ï¼éœ€è¦100èƒ½é‡æ‰èƒ½æ–½è‚¥ã€‚');
                console.log('æ–½è‚¥å¤±è´¥ï¼šèƒ½é‡ä¸è¶³');
            }
        }

        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
        function initEventListeners() {
            // è¿”å›æŒ‰é’®
            document.getElementById('backBtn').addEventListener('click', () => {
                window.history.back();
            });
            
            // æ–½è‚¥æŒ‰é’®
            document.getElementById('fertilizeBtn').addEventListener('click', fertilizeTree);
            
            // æŒ‰é’®ç‚¹å‡»æ•ˆæœ
            document.querySelectorAll('button, a').forEach(element => {
                element.addEventListener('mousedown', () => {
                    element.classList.add('btn-press');
                });
                
                element.addEventListener('mouseup', () => {
                    element.classList.remove('btn-press');
                });
                
                element.addEventListener('mouseleave', () => {
                    element.classList.remove('btn-press');
                });
            });
        }

        // åˆå§‹åŒ–åº”ç”¨
        function initApp() {
            console.log('å¼€å§‹ç§æ ‘é¡µé¢åˆå§‹åŒ–');
            initAppData();
            updateUI();
            initEventListeners();
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>